<html>
<head>
  <title>Williams Sonoma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
</head>
<body>

<style>
body {
    /*overflow: hidden*/
}
.background-container {
    width: 100%;
}

.background-container img {
    display: block;
    width: 100%;
    height: 200%;
}
</style>


<div class="background-container">
  <!-- <img src="https://esw1234.github.io/wsi.png" alt="Background"> -->
</div>

<input type="text" id="nudgeInput"><br><br>
<button type="button" onclick="sendNudge()">send nudge</button>
<script type='text/javascript'>
    let oliveReadyPromise, oliveReadyPromiseResolve;
    let isNewConversation = false;

    window.addEventListener("onEmbeddedMessagingReady", () => {
        resetOliveReadyPromise();
    });

    window.addEventListener("onEmbeddedMessagingConversationStarted", () => {
        isNewConversation = true;
    });

    window.addEventListener("onEmbeddedMessagingConversationOpened", () => {
        if (!isNewConversation) {
            resolveOliveReadyPromise();
        }
    });

    window.addEventListener("onEmbeddedMessagingFirstBotMessageSent", () => {
        resolveOliveReadyPromise();
    });

    function resetOliveReadyPromise() {
        oliveReadyPromise = new Promise((resolve) => {
            oliveReadyPromiseResolve = resolve;
        });
    }

    function resolveOliveReadyPromise() {
        if (oliveReadyPromiseResolve) {
            oliveReadyPromiseResolve();
        }
    }
	
	function sendNudge() {
        const nudgeText = document.getElementById("nudgeInput").value;
        embeddedservice_bootstrap.utilAPI.launchChat();
        oliveReadyPromise.then(() => {
            embeddedservice_bootstrap.utilAPI.sendTextMessage(nudgeText);
        });
	}

	function initEmbeddedMessaging() {
		try {
			embeddedservice_bootstrap.settings.language = 'en_US'; // For example, enter 'en' or 'en-US'
			embeddedservice_bootstrap.settings.devMode = true;

			embeddedservice_bootstrap.init(
				'00DSB00000aGFJL',
				'CWC_5',
				'https://orgfarm-cd97985f87.my.site-com.f1f9h67w8lzd1bmxa00yv89dt.wc.crm.dev:6101/ESWCWC11768329220029',
				{
					scrt2URL: 'https://orgfarm-d585323017.test1.my.pc-rnd.salesforce-scrt.com'
				}
			);
		} catch (err) {
			console.error('Error loading Embedded Messaging: ', err);
		}
	};
</script>
<script type='text/javascript' src='https://orgfarm-cd97985f87.my.site-com.f1f9h67w8lzd1bmxa00yv89dt.wc.crm.dev:6101/ESWCWC11768329220029/assets/js/bootstrap.js' onload='initEmbeddedMessaging()'></script>

</body>
</html>
