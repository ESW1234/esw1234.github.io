!function(){function e(){this.parentOrigin=void 0,this.messageHandlers={},this.featureScripts={},this.unloadEvent="none"===this.getSafariType()?"beforeunload":"pagehide",this.onloadEvent="none"===this.getSafariType()?"load":"pageshow",this.pendingMessages={},this.availableFeatures=["script"],window.location.search.replace(/([a-zA-Z0-9]+)=([\S]+)/g,function(e,s,i){"parent"===s&&(this.parentOrigin=i)}.bind(this)),this.parentOrigin?(this.addEventListeners(),this.loadFeatureScript("Session",function(){parent.postMessage({method:"session.onLoad"},this.parentOrigin)}.bind(this)),this.addMessageHandler("script.load",function(e,s){this.loadFeatureScript(s)}.bind(this))):console.error("No domain set!")}e.prototype.log=function(e){window.devMode&&console.log(e)},e.prototype.getSafariType=function(){var e=navigator.userAgent.toLowerCase();return-1===e.indexOf("chrome")&&-1!==e.indexOf("safari")?-1===e.indexOf("mobile")?"desktop":"mobile":"none"},e.prototype.addMessageHandler=function(e,s){this.messageHandlers[e]=s},e.prototype.addEventListeners=function(){window.addEventListener("message",function(e){var s,i,t,n=e.data;if(n.method){if(s=e.origin.indexOf("://")+3,i=e.origin.substring(s),i=i.split(":")[0],e.origin!==window.esw.parentOrigin.substr(0,e.origin.length))return void console.log("Message origin must match parent origin!");if(i!==n.domain&&-1===i.indexOf("."+n.domain,i.length-n.domain.length-1))return void console.log("sessionDomain must be a subdomain of message origin!");t=n.method.split(".")[0].toLowerCase(),-1===this.availableFeatures.indexOf(t)?(this.pendingMessages[t]||(this.pendingMessages[t]=[]),this.pendingMessages[t].push(n)):this.handleMessage(n)}}.bind(this),!1)},e.prototype.handleMessage=function(e){this.messageHandlers[e.method]?this.messageHandlers[e.method](e.domain,e.data):console.log("Unregistered method "+e.method+" received in frame.")},e.prototype.defineFeature=function(e,s){this.featureScripts[e]=s},e.prototype.loadFeatureScript=function(e,s){var i=e.toLowerCase(),t=document.createElement("script");t.type="text/javascript",t.src="frame/"+i+".esw"+(window.devMode?"":".min")+".js",t.onload=function(){this.featureScripts[e](this),s&&s(),this.availableFeatures.push(i),this.processPendingMessages(i)}.bind(this),document.body.appendChild(t)},e.prototype.postMessage=function(e,s){parent.postMessage({method:e,data:s},this.parentOrigin)},e.prototype.processPendingMessages=function(e){this.pendingMessages[e]&&(this.pendingMessages[e].forEach(function(e){this.handleMessage(e)}.bind(this)),this.pendingMessages[e]=void 0)},window.esw=new e}();