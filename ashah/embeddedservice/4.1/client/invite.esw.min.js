embedded_svc.defineFeature("Invite",function(p){var m=false;var d={};var r={};var w={};var o=0;var b="embeddedServiceAvatar";var i=new function(){var E={PAGE_COUNT:"snapinsPc",SESSION_START:"snapinsStart",PAGE:"snapinsPage_",PAGE_TIME:"snapinsPageTime_"};this.init=function(){var F=parseInt(window.localStorage.getItem(E.PAGE_COUNT),10)||0;if(!window.localStorage.getItem(E.SESSION_START)){window.localStorage.setItem(E.SESSION_START,new Date().getTime().toString());}window.localStorage.setItem(E.PAGE_COUNT,(F+1).toString());window.localStorage.setItem(E.PAGE+F.toString(),window.location.href);window.localStorage.setItem(E.PAGE_TIME+F.toString(),new Date().getTime());};this.getPageCount=function(){return parseInt(window.localStorage.getItem(E.PAGE_COUNT),10);};this.getSessionStart=function(){return window.localStorage.getItem(E.SESSION_START);};this.getCurrentPage=function(){return window.localStorage.getItem(E.PAGE+(this.getPageCount()-1).toString());};}();function D(E){var F=["Webkit","Moz","O","ms","Khtml"];var G;if(E.style.animationName!==undefined){return"";}F.forEach(function(H){if(E.style[H+"AnimationName"]!==undefined){G=H.toLowerCase();}});return G;}function u(F,E,G){if(F.addEventListener){F.addEventListener(E,G,false);}else{if(F.attachEvent){F.attachEvent("on"+E,G,false);}else{throw new Error("Could not add event listener");}}}function f(){}f.TYPE={STANDARD:"STANDARD",INVITE:"INVITE",AGENT:"AGENT"};f.prototype.init=function(F,E){this.buttonId=F;this.type=E;this.onlineState=undefined;this.trackers=[];};f.prototype.getType=function(){return this.type;};f.prototype.getOnlineState=function(){return this.onlineState;};f.prototype.setOnlineState=function(E){this.onlineState=E;this.trackers.forEach(function(F){F.setState(E);});};function j(){}j.prototype.init=function(F,E){this.left=F;this.right=E;};j.prototype.evaluate=function(E){return false;};function t(){}t.TYPE={NUMBER_OF_PAGE_VIEWS:"NUMBER_OF_PAGE_VIEWS",URL_MATCH:"URL_MATCH",SECONDS_ON_PAGE:"SECONDS_ON_PAGE",SECONDS_ON_SITE:"SECONDS_ON_SITE",CUSTOM_VARIABLE:"CUSTOM_VARIABLE"};t.OPERATOR={EQUALS:"EQUALS",NOT_EQUAL:"NOT_EQUAL",START_WITH:"START_WITH",CONTAINS:"CONTAINS",NOT_CONTAIN:"NOT_CONTAIN",LESS_THAN:"LESS_THAN",GREATER_THAN:"GREATER_THAN",LESS_OR_EQUAL:"LESS_OR_EQUAL",GREATER_OR_EQUAL:"GREATER_OR_EQUAL"};t.prototype.init=function(I,H,E,F,G){this.ruleId=I;this.buttonId=H;this.compareFrom=E;this.operator=F;this.compareTo=G;};t.prototype.getId=function(){return this.ruleId;};t.prototype.evaluate=function(F,E){switch(this.operator){case t.OPERATOR.EQUALS:p.log("Evaluate: "+F+" == "+E);return F===E;case t.OPERATOR.NOT_EQUAL:p.log("Evaluate: "+F+" != "+E);return F!==E;case t.OPERATOR.START_WITH:p.log("Evaluate: "+F+" indexOf "+E+" == 0");return F.indexOf(E)===0;case t.OPERATOR.CONTAINS:p.log("Evaluate: "+F+" indexOf "+E+" != -1");return F.indexOf(E)!==-1;case t.OPERATOR.NOT_CONTAIN:p.log("Evaluate: "+F+" indexOf "+E+" == -1");return F.indexOf(E)===-1;case t.OPERATOR.LESS_THAN:p.log("Evaluate: "+parseFloat(F)+" < "+parseFloat(E));return parseFloat(F)<parseFloat(E);case t.OPERATOR.GREATER_THAN:p.log("Evaluate: "+parseFloat(F)+" > "+parseFloat(E));return parseFloat(F)>parseFloat(E);case t.OPERATOR.LESS_OR_EQUAL:p.log("Evaluate: "+parseFloat(F)+" <= "+parseFloat(E));return parseFloat(F)<=parseFloat(E);case t.OPERATOR.GREATER_OR_EQUAL:p.log("Evaluate: "+parseFloat(F)+" >= "+parseFloat(E));return parseFloat(F)>=parseFloat(E);default:return undefined;}};function c(E){this.ruleId=E;j.prototype.init.call(this,null,null);}c.prototype=new j();c.prototype.evaluate=function(E){p.log("Evaluating Atom Node: "+this.ruleId);return E.getRule(this.ruleId).evaluate();};function x(F,E){j.prototype.init.call(this,F,E);}x.prototype=new j();x.prototype.evaluate=function(E){var F;p.log("Evaluating And Node");F=this.left.evaluate(E)&&this.right.evaluate(E);return F;};function l(F,E){j.prototype.init.call(this,F,E);}l.prototype=new j();l.prototype.evaluate=function(E){var F=this.left.evaluate(E)||this.right.evaluate(E);p.log("Evaluating Or Node");return F;};function y(E){j.prototype.init.call(this,E,null);}y.prototype=new j();y.prototype.evaluate=function(E){var F=!this.left.evaluate(E);p.log("Evaluating Not Node");return F;};function B(E){if(h(E)){return h(E).getTracker();}return null;}function s(){}s.prototype.init=function(G,E,F,H){if(window.innerWidth){this.realWidth=window.innerWidth;}else{if(document.documentElement&&document.documentElement.clientWidth){this.realWidth=document.documentElement.clientWidth;}else{if(document.body){this.realWidth=document.body.clientWidth;}}}if(window.innerHeight){this.realHeight=window.innerHeight;}else{if(document.documentElement&&document.documentElement.clientHeight){this.realHeight=document.documentElement.clientHeight;}else{if(document.body){this.realHeight=document.body.clientHeight;}}}this.offset=25;this.buttonId=G;this.animationPrefix=D(E);this.element=E;this.element.style.position=this.animationPrefix?"fixed":"absolute";this.element.style.left="-1000px";this.element.style.top="-1000px";this.element.style.zIndex="10000";this.element.style.display="";this.element.style.visibility="visible";this.width=this.element.offsetWidth;this.height=this.element.offsetHeight;this.startPosition=F;this.endPosition=H;};s.prototype.render=function(){this.element.style.display="";};s.prototype.renderFinish=function(){};s.prototype.remove=function(E){this.element.style.left="-1000px";this.element.style.top="-1000px";};s.prototype.addRenderListeners=function(){var F=this.buttonId;var E="AnimationIteration";var G="AnimationEnd";if(this.animationPrefix===""){E=E.toLowerCase();G=G.toLowerCase();}else{E=this.animationPrefix+E;G=this.animationPrefix+G;}u(this.element,E,function(){B(F).renderFinish();});u(this.element,G,function(){B(F).removeFinish();});};function A(G,E,F,H){s.prototype.init.call(this,G,E,F,H);}A.prototype=new s();A.prototype.render=function(){var F=this.width*this.startPosition.xPosition+this.offset*this.startPosition.xOffset;var J=this.height*this.startPosition.yPosition+this.offset*this.startPosition.yOffset;var H=this.width*this.endPosition.xPercent*-1+this.offset*this.endPosition.xOffset;var G=this.height*this.endPosition.yPercent*-1+this.offset*this.endPosition.yOffset;var E=document.createElement("style");var I="";s.prototype.addRenderListeners.call(this);if(this.animationPrefix!==""){I="-"+this.animationPrefix+"-";}E.innerHTML="@"+I+"keyframes slide"+this.buttonId+"{"+"from { margin-left: "+F+"px; margin-top: "+J+"px; left: "+this.startPosition.xPercent*100+"%; top: "+this.startPosition.yPercent*100+"%; }"+"to { margin-left: "+H+"px; margin-top: "+G+"px; left: "+this.endPosition.xPercent*100+"%; top: "+this.endPosition.yPercent*100+"%; }"+"}";document.getElementsByTagName("head")[0].appendChild(E);this.element.style[I+"animation-name"]="slide"+this.buttonId;this.element.style[I+"animation-duration"]="1s";this.element.style[I+"animation-iteration-count"]="2";this.element.style[I+"animation-direction"]="alternate";this.element.style[I+"animation-timing-function"]="ease-in-out";this.element.style.setProperty(I+"animation-name","slide"+this.buttonId,"");this.element.style.setProperty(I+"animation-duration","1s","");this.element.style.setProperty(I+"animation-iteration-count","2","");this.element.style.setProperty(I+"animation-direction","alternate","");this.element.style.setProperty(I+"animation-timing-function","ease-in-out","");s.prototype.render.call(this);};A.prototype.renderFinish=function(){var E="";if(this.animationPrefix!==""){E="-"+this.animationPrefix+"-";}this.element.style[E+"animation-play-state"]="paused";this.element.style.setProperty(E+"animation-play-state","paused","");};A.prototype.remove=function(E){var F="";if(this.animationPrefix!==""){F="-"+this.animationPrefix+"-";}if(E){this.element.style[F+"animation-play-state"]="running";this.element.style.setProperty(F+"animation-play-state","running","");}else{this.element.style[F+"animation-name"]="";this.element.style.setProperty(F+"animation-name","","");s.prototype.remove.call(this,E);}};function a(G,E,F,H){s.prototype.init.call(this,G,E,null,H);}a.prototype=new s();a.prototype.render=function(){var E="";var H=document.createElement("style");var G=this.width*this.endPosition.xPercent*-1+this.offset*this.endPosition.xOffset;var F=this.height*this.endPosition.yPercent*-1+this.offset*this.endPosition.yOffset;s.prototype.addRenderListeners.call(this);if(this.animationPrefix!==""){E="-"+this.animationPrefix+"-";}H.innerHTML="@"+E+"keyframes fade"+this.buttonId+"{"+"from { opacity: 0; }"+"to { opacity: 1; }"+"}";document.getElementsByTagName("head")[0].appendChild(H);this.element.style[E+"animation-name"]="fade"+this.buttonId;this.element.style[E+"animation-duration"]="1s";this.element.style[E+"animation-iteration-count"]="2";this.element.style[E+"animation-direction"]="alternate";this.element.style[E+"animation-timing-function"]="ease-in-out";this.element.style.setProperty(E+"animation-name","fade"+this.buttonId,"");this.element.style.setProperty(E+"animation-duration","1s","");this.element.style.setProperty(E+"animation-iteration-count","2","");this.element.style.setProperty(E+"animation-direction","alternate","");this.element.style.setProperty(E+"animation-timing-function","ease-in-out","");this.element.style.marginLeft=G+"px";this.element.style.left=this.endPosition.xPercent*100+"%";this.element.style.marginTop=F+"px";this.element.style.top=this.endPosition.yPercent*100+"%";s.prototype.render.call(this);};a.prototype.renderFinish=function(){var E="";if(this.animationPrefix!==""){E="-"+this.animationPrefix+"-";}this.element.style[E+"animation-name"]="";this.element.style.setProperty(E+"animation-name","","");};a.prototype.remove=function(E){var F="";if(this.animationPrefix!==""){F="-"+this.animationPrefix+"-";}if(E){this.element.style[F+"animation-play-state"]="running";this.element.style.setProperty(F+"animation-play-state","running","");this.element.style.opacity=0;}else{this.element.style[F+"animation-name"]="";this.element.style.setProperty(F+"animation-name","","");s.prototype.remove.call(this,E);}};function k(G,E,F,H){s.prototype.init.call(this,G,E,null,H);}k.prototype=new s();k.prototype.render=function(){var F=this.width*this.endPosition.xPercent*-1+this.offset*this.endPosition.xOffset;var E=this.height*this.endPosition.yPercent*-1+this.offset*this.endPosition.yOffset;this.element.style.marginLeft=F+"px";this.element.style.left=this.endPosition.xPercent*100+"%";this.element.style.marginTop=E+"px";this.element.style.top=this.endPosition.yPercent*100+"%";s.prototype.render.call(this);B(this.buttonId).renderFinish();};k.prototype.remove=function(E){if(E){B(this.buttonId).removeFinish();}else{s.prototype.remove.call(this,E);}};function C(E){f.prototype.init.call(this,E,f.TYPE.INVITE);this.active=false;this.filterLogic=null;this.rules={};this.ruleTree=null;this.inviteDelay=null;this.inviteTimeout=null;this.autoRejectTimeout=null;}C.prototype=new f();C.RENDERER={Slide:{RenderClass:A},Fade:{RenderClass:a},Appear:{RenderClass:k}};C.START_POSITION={TopLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:0,yPosition:-1,yOffset:-1},TopLeftTop:{xPercent:0,xPosition:0,xOffset:1,yPercent:0,yPosition:-1,yOffset:-1},Top:{xPercent:0.5,xPosition:-0.5,xOffset:0,yPercent:0,yPosition:-1,yOffset:-1},TopRightTop:{xPercent:1,xPosition:-1,xOffset:-1,yPercent:0,yPosition:-1,yOffset:-1},TopRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:0,yPosition:-1,yOffset:-1},TopRightRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:0,yPosition:0,yOffset:1},Right:{xPercent:1,xPosition:0,xOffset:1,yPercent:0.5,yPosition:-0.5,yOffset:0},BottomRightRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:1,yPosition:-1,yOffset:-1},BottomRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:1,yPosition:0,yOffset:1},BottomRightBottom:{xPercent:1,xPosition:-1,xOffset:-1,yPercent:1,yPosition:0,yOffset:1},Bottom:{xPercent:0.5,xPosition:-0.5,xOffset:0,yPercent:1,yPosition:0,yOffset:1},BottomLeftBottom:{xPercent:0,xPosition:0,xOffset:1,yPercent:1,yPosition:0,yOffset:1},BottomLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:1,yPosition:0,yOffset:1},BottomLeftLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:1,yPosition:-1,yOffset:-1},Left:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:0.5,yPosition:-0.5,yOffset:0},TopLeftLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:0,yPosition:0,yOffset:1}};C.END_POSITION={TopLeft:{xPercent:0,xOffset:1,yPercent:0,yOffset:1},Top:{xPercent:0.5,xOffset:0,yPercent:0,yOffset:1},TopRight:{xPercent:1,xOffset:-1,yPercent:0,yOffset:1},Left:{xPercent:0,xOffset:1,yPercent:0.5,yOffset:0},Center:{xPercent:0.5,xOffset:0,yPercent:0.5,yOffset:0},Right:{xPercent:1,xOffset:-1,yPercent:0.5,yOffset:0},BottomLeft:{xPercent:0,xOffset:1,yPercent:1,yOffset:-1},Bottom:{xPercent:0.5,xOffset:0,yPercent:1,yOffset:-1},BottomRight:{xPercent:1,xOffset:-1,yPercent:1,yOffset:-3}};function h(E){if(!w[E]){w[E]=new C(E);}return w[E];}function g(I,H,E,F,G){t.prototype.init.call(this,I,H,E,F,G);}g.prototype=new t();g.prototype.evaluate=function(){p.log("Evaluating StandardInviteRule");return t.prototype.evaluate.call(this,this.compareFrom,this.compareTo);};function v(I,H,E,F,G){t.prototype.init.call(this,I,H,E,F,G);}v.prototype=new t();v.prototype.evaluate=function(){var E=new Date().getTime()-this.compareFrom;var F=t.prototype.evaluate.call(this,E,this.compareTo);var G;p.log("Evaluating TimerInviteRule");if(!F&&E<=this.compareTo){G=this.compareTo-E;if(h(this.buttonId).getInviteDelay()===null||G<h(this.buttonId).getInviteDelay()){h(this.buttonId).setInviteDelay(G);}}return F;};function z(I,H,E,F,G){t.prototype.init.call(this,I,H,E,F,G);}z.prototype=new t();z.prototype.evaluate=function(){if(d.hasOwnProperty(this.compareFrom)){p.log("Evaluating CustomInviteRule");return t.prototype.evaluate.call(this,d[this.compareFrom].toString(),this.compareTo);}p.log("CustomInviteRule evaluation failed due to missing custom variable");return false;};function e(H){var G=0;var I=0;var F;var J;var E;o+=1;if(o>1000){throw new Error("Error processing rule filter logic, preventing recursion");}for(F=0;F<H.length;F+=1){if(H.charAt(F)==="("){I+=1;}else{if(H.charAt(F)===")"){I-=1;}}if(H.charAt(F)===","&&I===1){G=F;}}if(H.indexOf("AND(")===0){J=e(H.substring(4,G));E=e(H.substring(G+1,H.length-1));return new x(J,E);}else{if(H.indexOf("OR(")===0){J=e(H.substring(3,G));E=e(H.substring(G+1,H.length-1));return new l(J,E);}else{if(H.indexOf("NOT(")===0){J=e(H.substring(4,H.length-1));return new y(J);}else{if(!isNaN(parseInt(H,10))){return new c(parseInt(H,10));}}}}throw new Error("Encountered unexpected character in filter logic");}function n(J,H,L,I,K,E,G,F){this.buttonId=J;this.element=H;this.hasInviteAfterAccept=E;this.hasInviteAfterReject=G;this.rejectTime=F;if(D(H)===null){this.renderer=new C.RENDERER.Appear.RenderClass(J,H,C.START_POSITION[I],C.END_POSITION[K]);}else{this.renderer=new C.RENDERER[L].RenderClass(J,H,C.START_POSITION[I],C.END_POSITION[K]);}}n.prototype.setState=function(E){if(E&&!m&&h(this.buttonId).trigger()){m=true;this.renderer.render();}else{if(!E&&h(this.buttonId).isActive()){m=false;this.remove(true);}}};n.prototype.renderFinish=function(){var E=this.buttonId;h(this.buttonId).setActive(true);if(this.rejectTime!==-1){h(this.buttonId).setAutoRejectTimeout(window.setTimeout(function(){h(E).rejectInvite();},this.rejectTime*1000));}this.renderer.renderFinish();};n.prototype.accept=function(){if(!this.hasInviteAfterAccept){p.setCookie("liveagent_invite_rejected_"+this.buttonId,true,false);}this.remove(false);};n.prototype.reject=function(){if(!this.hasInviteAfterReject){p.setCookie("liveagent_invite_rejected_"+this.buttonId,true,false);}this.remove(true);};n.prototype.remove=function(E){h(this.buttonId).setActive(false);this.renderer.remove(E);};n.prototype.removeFinish=function(){this.renderer.remove(false);};C.prototype.setRules=function(H,E){var I;var F;var G;if(!H||!E){return;}for(I in H){if(H.hasOwnProperty(I)){F=H[I];G=null;switch(F.type){case t.TYPE.NUMBER_OF_PAGE_VIEWS:G=new g(F.order,this.buttonId,i.getPageCount(),F.operator,parseInt(F.value,10));break;case t.TYPE.URL_MATCH:G=new g(F.order,this.buttonId,i.getCurrentPage(),F.operator,F.value);break;case t.TYPE.SECONDS_ON_PAGE:G=new v(F.order,this.buttonId,new Date().getTime(),F.operator,parseInt(F.value,10)*1000);break;case t.TYPE.SECONDS_ON_SITE:G=new v(F.order,this.buttonId,parseInt(i.getSessionStart(),10),F.operator,parseInt(F.value,10)*1000);break;case t.TYPE.CUSTOM_VARIABLE:G=new z(F.order,this.buttonId,F.name,F.operator,F.value);if(!r.hasOwnProperty(F.name)){r[F.name]=[];}r[F.name].push(this.buttonId);break;default:break;}if(G!==null){this.addRule(G);}}}this.filterLogic=E;this.ruleTree=e(E);};C.prototype.setOnlineState=function(E){if(!E&&this.inviteTimeout!==null){clearTimeout(this.inviteTimeout);this.inviteTimeout=null;}if(!E&&this.autoRejectTimeout!==null){clearTimeout(this.autoRejectTimeout);this.autoRejectTimeout=null;}f.prototype.setOnlineState.call(this,E);};C.prototype.isActive=function(){return this.active;};C.prototype.setActive=function(E){this.active=E;};C.prototype.addTracker=function(E,G){var F;if(/Mobi/.test(navigator.userAgent)){F=new n(G.id,E,"Fade",undefined,"BottomRight",G.hasInviteAfterAccept,G.hasInviteAfterReject,G.inviteRejectTime);}else{F=new n(G.id,E,G.inviteRenderer,G.inviteStartPosition,G.inviteEndPosition,G.hasInviteAfterAccept,G.hasInviteAfterReject,G.inviteRejectTime);}this.trackers=[];this.trackers.push(F);};C.prototype.getTracker=function(){if(this.trackers.length>1){throw new Error("InviteButtons should have less than 1 tracker");}return this.trackers[0];};C.prototype.acceptInvite=function(){p.onHelpButtonClick();this.getTracker().accept();};C.prototype.rejectInvite=function(){this.getTracker().reject();};C.prototype.setCustomVariable=function(F,G){var E;d[F]=G;if(r.hasOwnProperty(F)){r[F].forEach(function(H){E=h(H);if(E.getOnlineState()){E.setOnlineState(true);}});}};C.prototype.trigger=function(){var G=true;var E=this;var F=p.componentInitInProgress||document.getElementsByClassName("embeddedServiceSidebar").length>0;if(p.getCookie("liveagent_invite_rejected_"+this.buttonId)||F){return false;}if(this.ruleTree!==null){p.log("Invite "+this.buttonId+" Rule Evaluation");p.log("Filter Logic: "+this.filterLogic);G=this.ruleTree.evaluate(this);}if(!G&&this.inviteDelay!==null){this.inviteTimeout=window.setTimeout(function(){E.setOnlineState(true);},this.inviteDelay);this.inviteDelay=null;}return G;};C.prototype.addRule=function(E){this.rules[E.getId()]=E;};C.prototype.getRule=function(E){return this.rules[E];};C.prototype.getInviteDelay=function(){return this.inviteDelay;};C.prototype.setInviteDelay=function(E){p.log("Setting invite delay to: "+E);this.inviteDelay=E;};C.prototype.setAutoRejectTimeout=function(E){this.autoRejectTimeout=E;};function q(){this.inviteButton=h(p.settings.buttonId);i.init();if(document.getElementById(b)){if(embedded_svc.settings.avatarImgURL){document.getElementById(b).src=embedded_svc.settings.avatarImgURL;}else{document.getElementById(b).remove();}}}p.inviteAPI=new q();});