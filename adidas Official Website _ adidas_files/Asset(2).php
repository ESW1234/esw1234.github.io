(void 0===window.QSI.ScreenCaptureRectangle||window.QTest)&&(QSI.ScreenCaptureRectangle=QSI.util.Class({initialize:function(a,b){this.isCanvasDirty=!1,this.rectangles=[],this.canvas=QSI.util.build("canvas",{"data-qsi-sc-class":"qsi_sc_annotations_canvas",width:a.width,height:a.height},[]),this.context=this.canvas.getContext("2d"),this.selectedRectangle=null,this.clickedObject=null,this.setupMouseListeners(),setInterval(this.mainDraw.bind(this),b)},getCanvas:function(){return this.canvas},getCleanedCanvas:function(){return this.selectedRectangle&&this.selectedRectangle.deselect(),this.isCanvasDirty=!0,this.mainDraw(),this.canvas},addRectangle:function(a,b,c,d,e,f){f||(f=1);var g=new this.Rectangle(this,a,b,c,d,e,f);this.rectangles.push(g),g.select(),this.isCanvasDirty=!0},save:function(){this.savedRectangles=[],this.cloneRectangles(this.rectangles,this.savedRectangles)},cancel:function(){this.savedRectangles?this.cloneRectangles(this.savedRectangles,this.rectangles):this.rectangles=[],this.isCanvasDirty=!0},cloneRectangles:function(a,b){b.splice(0,b.length);for(var c=0;c<a.length;c++){var d=a[c];b.push(new this.Rectangle(this,d.x,d.y,d.w,d.h,d.color,d.opacity))}},mainDraw:function(){if(this.isCanvasDirty){this.clearContext(this.context);for(var a=0;a<this.rectangles.length;a++)this.rectangles[a].draw(this.context);this.isCanvasDirty=!1}},setupMouseListeners:function(){this.mouseState={isMouseDown:!1,mouseDownPosition:{x:0,y:0}},QSI.util.observe(this.canvas,"mousedown",this.mouseDownHandler.bind(this)),QSI.util.observe(this.canvas,"mousemove",this.mouseMoveHandler.bind(this)),QSI.util.observe(this.canvas,"mouseup",this.upHandler.bind(this)),QSI.util.observe(this.canvas,"mouseout",this.upHandler.bind(this)),QSI.util.observe(this.canvas,"touchstart",this.touchStartHandler.bind(this)),QSI.util.observe(this.canvas,"touchmove",this.touchMoveHandler.bind(this)),QSI.util.observe(this.canvas,"touchend",this.upHandler.bind(this))},mouseDownHandler:function(a){var b=this.getMouseLocationInCanvas(a);b&&(this.downHandler(a,b.x,b.y),a.preventDefault())},touchStartHandler:function(a){var b=this.getTouchLocationInCanvas(a);b&&this.downHandler(a,b.x,b.y)},downHandler:function(a,b,c){a.preventDefault(),this.mouseState.isMouseDown=!0,this.mouseState.mouseDownPosition.x=b,this.mouseState.mouseDownPosition.y=c,this.clickedObject=this.getObjectAtCoordinates(b,c),this.clickedObject&&this.clickedObject.select(),this.isCanvasDirty=!0,this.clickedObject===this.selectedRectangle||this.clickedObject instanceof this.ResizePoint||this.clickedObject instanceof this.RemoveButton||(this.selectedRectangle.deselect(),this.selectedRectangle=null),this.isCanvasDirty=!0},mouseMoveHandler:function(a){var b=this.getMouseLocationInCanvas(a);this.moveHandler(a,b.x,b.y)},touchMoveHandler:function(a){var b=this.getTouchLocationInCanvas(a);return b.x<0||b.x>this.canvas.width||b.y<0||b.y>this.canvas.height?void this.upHandler(a):void this.moveHandler(a,b.x,b.y)},moveHandler:function(a,b,c){if(a.preventDefault(),!this.mouseState.isMouseDown){var d=this.getObjectAtCoordinates(b,c);return void(d?d.hover(this.canvas):this.canvas.style.cursor="auto")}var e=b-this.mouseState.mouseDownPosition.x,f=c-this.mouseState.mouseDownPosition.y;this.clickedObject&&this.clickedObject.drag(e,f),this.mouseState.mouseDownPosition.x=b,this.mouseState.mouseDownPosition.y=c,this.isCanvasDirty=!0},upHandler:function(a){this.mouseState.isMouseDown=!1,a.preventDefault()},getTouchLocationInCanvas:function(a){if(!a||!a.targetTouches||!a.targetTouches[0])return null;var b=a.targetTouches[0];return this.getLocationInCanvas(b.clientX,b.clientY)},getMouseLocationInCanvas:function(a){return a?this.getLocationInCanvas(a.clientX,a.clientY):null},getLocationInCanvas:function(a,b){return this.canvas.getBoundingClientRect(),canvasTopOffset=parseInt(this.canvas.parentElement.style.top,10),canvasLeftOffset=parseInt(this.canvas.parentElement.style.left,10),a-=canvasLeftOffset,b-=canvasTopOffset,{x:a,y:b}},getObjectAtCoordinates:function(a,b){var c=[];if(this.selectedRectangle){c.push(this.selectedRectangle.removeButton);for(var d=this.selectedRectangle.resizePoints,e=0;e<d.length;e++)c.push(d[e])}for(var f=this.rectangles.length-1;f>=0;f--)c.push(this.rectangles[f]);for(var g=0;g<c.length;g++)if(c[g].isAtLocation(a,b))return c[g];return null},clearContext:function(a){a.clearRect(0,0,this.canvas.width,this.canvas.height)},RemoveButton:QSI.util.Class({initialize:function(a,b){this.rectangle=a,this.xOffset=18,this.yOffset=-16,this.interactionSquareLength=b},getButtonLocation:function(){var a=this.rectangle.x+this.rectangle.w+this.xOffset,b=this.rectangle.y+this.yOffset;return{x:a,y:b}},isAtLocation:function(a,b){var c=this.getButtonLocation(),d=this.interactionSquareLength/2;return a>=c.x-d&&a<=c.x+d&&b>=c.y-d&&b<=c.y+d},select:function(){this.rectangle.destroy()},hover:function(a){a.style.cursor="pointer"},drag:function(){},draw:function(a){var b=this.getButtonLocation();this.drawHelper(a,b.x,b.y,4,5,"white",.5),this.drawHelper(a,b.x,b.y,2,4,"black",1)},drawHelper:function(a,b,c,d,e,f,g){a.beginPath(),a.lineWidth=d,a.strokeStyle=f,a.lineCap="round",a.globalAlpha=g,a.moveTo(b-e,c-e),a.lineTo(b+e,c+e),a.stroke(),a.moveTo(b+e,c-5),a.lineTo(b-e,c+e),a.stroke()}}),ResizePoint:QSI.util.Class({initialize:function(a,b,c,d,e){this.rectangleAnnotations=a,this.rectangle=b,this.direction=c,this.circleRadius=d,this.interactionSquareLength=e},getPointLocation:function(){var a=0,b=0;switch(this.direction){case"nw":a=this.rectangle.x,b=this.rectangle.y;break;case"ne":a=this.rectangle.x+this.rectangle.w,b=this.rectangle.y;break;case"se":a=this.rectangle.x+this.rectangle.w,b=this.rectangle.y+this.rectangle.h;break;case"sw":a=this.rectangle.x,b=this.rectangle.y+this.rectangle.h}return{x:a,y:b}},isAtLocation:function(a,b){var c=this.getPointLocation(),d=this.interactionSquareLength/2;return a>=c.x-d&&a<=c.x+d&&b>=c.y-d&&b<=c.y+d},draw:function(a){var b=this.getPointLocation();a.beginPath(),a.arc(b.x,b.y,this.circleRadius,0,2*Math.PI,!1),a.fillStyle="red",a.fill(),a.lineWidth=1,a.strokeStyle="red",a.stroke()},select:function(){},drag:function(a,b){switch(this.direction){case"nw":this.transform(a,b,-a,-b);break;case"ne":this.transform(0,b,a,-b);break;case"se":this.transform(0,0,a,b);break;case"sw":this.transform(a,0,-a,b)}},transform:function(a,b,c,d){this.rectangle.x+a<0?this.rectangle.x=0:this.rectangle.w+c<0?this.rectangle.w=0:this.rectangle.x+a+this.rectangle.w+c>this.rectangleAnnotations.canvas.width?this.rectangle.w=this.rectangleAnnotations.canvas.width-this.rectangle.x:(this.rectangle.x+=a,this.rectangle.w+=c),this.rectangle.y+b<0?this.rectangle.y=0:this.rectangle.h+d<0?this.rectangle.h=0:this.rectangle.y+b+this.rectangle.h+d>this.rectangleAnnotations.canvas.height?this.rectangle.h=this.rectangleAnnotations.canvas.height-this.rectangle.y:(this.rectangle.y+=b,this.rectangle.h+=d)},hover:function(a){switch(this.direction){case"nw":case"se":a.style.cursor="nwse-resize";break;case"ne":case"sw":a.style.cursor="nesw-resize"}}}),Rectangle:QSI.util.Class({initialize:function(a,b,c,d,e,f,g){this.rectangleAnnotations=a,this.x=b,this.y=c,this.w=d,this.h=e,this.color=f,this.opacity=g?g:1,this.resizePoints=[],this.removeButton=null,this.isSelected=!1},isAtLocation:function(a,b){return a>=this.x&&a<=this.x+this.w&&b>=this.y&&b<=this.y+this.h},select:function(){if(0===this.resizePoints.length)for(var a=["nw","ne","se","sw"],b=0;b<a.length;b++)this.resizePoints.push(new this.rectangleAnnotations.ResizePoint(this.rectangleAnnotations,this,a[b],3,24));this.removeButton||(this.removeButton=new this.rectangleAnnotations.RemoveButton(this,26)),this.rectangleAnnotations.selectedRectangle&&this.rectangleAnnotations.selectedRectangle.deselect(),this.rectangleAnnotations.selectedRectangle=this,this.isSelected=!0},deselect:function(){this.isSelected=!1},destroy:function(){this.rectangleAnnotations.selectedRectangle=null;var a=this.rectangleAnnotations.rectangles;a.splice(a.indexOf(this),1)},draw:function(a){if(a.fillStyle=this.color,a.globalAlpha=this.opacity,a.fillRect(this.x,this.y,this.w,this.h),a.globalAlpha=1,this.isSelected){a.strokeStyle="red",a.lineWidth=1,a.strokeRect(this.x,this.y,this.w,this.h);for(var b=0;b<this.resizePoints.length;b++)this.resizePoints[b].draw(a);this.removeButton.draw(a)}},drag:function(a,b){this.x+=a,this.y+=b,this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x+this.w>this.rectangleAnnotations.canvas.width&&(this.x=this.rectangleAnnotations.canvas.width-this.w),this.y+this.h>this.rectangleAnnotations.canvas.height&&(this.y=this.rectangleAnnotations.canvas.height-this.h)},hover:function(a){a.style.cursor="move"}})}));
(void 0===window.QSI.ScreenCaptureHandler||window.QTest)&&(QSI.ScreenCaptureHandler=QSI.util.Class({initialize:function(a,b,c){this.intercept=a,this.embeddedTarget=b,this.surveySessionId=c,this.scZIndex=QSI.global.currentZIndex++,this.createCapturingScreen()},createCapturingScreen:function(){var a=QSI.util.build("div",{"data-qsi-sc-class":"qsi_sc_backdrop",style:{width:"100%",height:"100%",backgroundColor:"black",opacity:"0.7",filter:"alpha(opacity=70)",position:"fixed",top:"0px",left:"0px",zIndex:this.scZIndex-1}},[]),b=100,c=QSI.util.build("img",{"data-qsi-sc-class":"qsi_sc_loading_icon",src:QSI.baseURL+"../WRQualtricsShared/Graphics/siteintercept/building_preview.gif",style:{width:b+"px"},alt:""},[]),d=QSI.util.build("img",{"data-qsi-sc-class":"qsi_sc_cancel_capture_button",src:QSI.baseURL+"../WRQualtricsShared/Graphics/siteintercept/remove_screen_capture.png",title:"Cancel Capturing Screen",style:{"-webkit-filter":"brightness(0) invert(1)",filter:"brightness(0) invert(1)",display:"block",width:"15px",height:"15px",marginLeft:b+"px",cursor:"pointer"},alt:"Cancel"},[]);this.isScreenCaptureCancelled=!1;var e=this;QSI.util.observe(d,"click",function(){e.isScreenCaptureCancelled=!0,e.hideCapturingScreen()});var f=QSI.util.build("div",{"data-qsi-sc-class":"qsi_sc_building_preview_text",style:{color:"white"}},[]);f.innerHTML="Building Preview ...";var g=parseInt(window.innerWidth,10),h=parseInt(window.innerHeight,10);this.scCapturingScreen=QSI.util.build("div",{"data-qsi-sc-class":"qsi_sc_capturing_screen",style:{position:"fixed",top:h/2+"px",left:g/2+"px",marginTop:b/-2+"px",marginLeft:b/-2+"px",zIndex:this.scZIndex}},[d,c,f]),this.scScreen=QSI.util.build("div",{className:"QSI_ScreenCapture",style:{visibility:"hidden"}},[a,this.scCapturingScreen]),document.body.appendChild(this.scScreen)},showCapturingScreen:function(){this.setInterceptVisibilty("hidden"),this.scScreen.style.visibility="visible"},hideCapturingScreen:function(){this.setInterceptVisibilty("visible"),this.scScreen.style.visibility="hidden"},setInterceptVisibilty:function(a){if(this.intercept.container?this.intercept.container.style.visibility=a:this.intercept.link&&"FeedbackLink"===this.intercept.type?this.intercept.link.style.visibility=a:this.intercept.bar&&(this.intercept.bar.style.visibility=a),this.intercept.embeddedWindows)for(var b=0;b<this.intercept.embeddedWindows.length;b++)this.intercept.embeddedWindows[b].container.style.visibility=a},captureScreen:function(a){this.showCapturingScreen();var b=this.getCleanedHTML(),c=this;QSI.util.sendHttpRequest({type:"POST",url:QSI.global.screenCaptureServiceBaseURL+"screencapture",header:{"Content-type":"application/json"},data:JSON.stringify({html:b.documentElement.innerHTML,viewportData:this.getViewPortDimensions(),url:window.location.href}),successCallback:function(b){var d;d=JSON.parse(b.response?b.response:b.responseText);var e="data:image/jpeg;base64,"+d.imageData;return c.isScreenCaptureCancelled?void(c.isScreenCaptureCancelled=!1):void c.succeededScreenCapture(a,e)},errorCallback:function(a){return c.isScreenCaptureCancelled?void(c.isScreenCaptureCancelled=!1):void c.failedScreenCapture("ScreenCapture call POST request to "+QSI.global.screenCaptureServiceBaseURL+"screencapture returned with readyState="+a.readyState+" and status="+a.status)},timeout:1e4,timeoutCallback:function(){QSI.dbg.e("ScreenCapture call POST request to "+QSI.global.screenCaptureServiceBaseURL+"screencapture timed out")}})},editAnnotations:function(a){this.screenCaptureAnnotationsMap&&this.screenCaptureAnnotationsMap[a]&&this.screenCaptureAnnotationsMap[a].showAnnotationsArea()},succeededScreenCapture:function(a,b){this.scScreen.style.visibility="hidden",this.screenCaptureAnnotationsMap||(this.screenCaptureAnnotationsMap={}),this.screenCaptureAnnotationsMap[a]=new QSI.ScreenCaptureAnnotations(this,a,b)},saveScreenCapture:function(a,b){this.setInterceptVisibilty("visible");var c={event:"saveScreenCapture",from:"SI",to:"JFE",sessionId:this.surveySessionId,questionId:a,imageData:b};this.sendMessageToSurvey(c)},failedScreenCapture:function(a){QSI.dbg.e(a),this.scScreen.style.visibility="visible",this.scCapturingScreen.style.visibility="hidden";var b=QSI.util.build("p",{"data-qsi-sc-class":"qsi_sc_failure_message",style:{textAlign:"left",width:"150px",fontSize:"13px",lineHeight:"18px",marginTop:"5px",marginBottom:"10px"}},[]);b.innerHTML="Sorry, we couldn't create a screenshot. Please try again later.";var c=QSI.util.build("img",{"data-qsi-sc-class":"qsi_sc_failure_icon",src:QSI.baseURL+"../WRQualtricsShared/Graphics/siteintercept/error_icon.png",style:{display:"inline-block",verticalAlign:"top",height:"30px",width:"30px",marginTop:"7px"},alt:"Error"},[]),d=QSI.util.build("p",{"data-qsi-sc-class":"qsi_sc_failure_confirm",style:{display:"table-cell",verticalAlign:"middle",backgroundColor:"#1cb06f",color:"white",width:"100px",height:"30px",borderRadius:"5px",fontSize:"13px",cursor:"pointer"}},[]);d.innerHTML="OK";var e=QSI.util.build("div",{"data-qsi-sc-class":"qsi_sc_failure_message_container",style:{display:"inline-block",marginLeft:"15px"}},[b,d]),f=QSI.util.build("div",{"data-qsi-sc-class":"qsi_sc_failure_popover",style:{position:"fixed",top:"50%",left:"50%",marginTop:"-55px",marginLeft:"-110px",width:"220px",height:"110px",textAlign:"center",fontFamily:"Arial",borderRadius:"3px",background:"rgba(255, 255, 255, 0.95)",zIndex:this.scZIndex}},[c,e]),g=this;QSI.util.observe(d,"click",function(){QSI.util.remove(f),g.scCapturingScreen.style.visibility="inherit",g.hideCapturingScreen()}),this.scScreen.appendChild(f)},removeScreenCapture:function(a){this.screenCaptureAnnotationsMap&&this.screenCaptureAnnotationsMap[a]&&(this.screenCaptureAnnotationsMap[a].destroyAnnotationsArea(),delete this.screenCaptureAnnotationsMap[a])},removeAllScreenCaptures:function(){if(this.screenCaptureAnnotationsMap)for(var a in this.screenCaptureAnnotationsMap)this.removeScreenCapture(a)},getCleanedHTML:function(){for(var a=document.cloneNode(!0),b=document.body.getElementsByTagName("*"),c=a.body.getElementsByTagName("*"),d=[],e=0;e<c.length;e++)if(window.getComputedStyle){var f=QSI.util.getComputedStyle(b[e]);c[e].style.boxSizing=f.boxSizing;var g=window.getComputedStyle(b[e],":before").display,h=window.getComputedStyle(b[e],":after").display;if(("table"===g||"block"===g||"table"===h||"block"===h)&&(c[e].style.height=f.height),c[e].style.display=f.display,0===parseInt(f.height,10)&&(c[e].style.height="0px"),this.isElementAdvertisement(c[e])){var i=QSI.util.build("span",{style:{color:"black",fontSize:"15px",lineHeight:"15px"}},[]);i.innerHTML="ADVERTISEMENT";var j=QSI.util.build("div",{style:{width:f.width,height:f.height,backgroundColor:"white",border:"1px solid black",padding:"3px",textAlign:"center"}},[i]);d.push({originalElement:c[e],replacementElement:j})}}for(var k=0;k<d.length;k++)d[k].originalElement.parentNode.replaceChild(d[k].replacementElement,d[k].originalElement);return document.body.style.backgroundColor||a.body.setAttribute("style",a.body.getAttribute("style")+"; background-color:white;"),QSI.util.removeAllByQuery(a,"noscript"),QSI.util.removeAllByQuery(a,'[data-qsi-sc-class="qsi_sc_capturing_screen"]'),QSI.util.removeAllByQuery(a,'[data-qsi-sc-class="qsi_sc_backdrop"]'),QSI.util.removeAllByQuery(a.head,"iframe"),a},isElementAdvertisement:function(a){return"div"===a.tagName.toLowerCase()&&-1!==a.id.indexOf("google_ads_iframe")?!0:!1},getViewPortDimensions:function(){var a=QSI.util.getScrollOffsets();return{width:window.innerWidth,height:window.innerHeight,top:a.top,left:a.left}},sendMessageToSurvey:function(a){string_message=JSON.stringify(a),this.embeddedTarget.postMessage(string_message,"*")}})),QSI.screenCaptureListenerRegistered||(QSI.screenCaptureListenerRegistered=!0,window.addEventListener("message",function(a){var b=QSI.util.getOriginInterceptOfMessage(a.source);if(b){if(messageObject=a.data,"string"==typeof messageObject)try{messageObject=JSON.parse(messageObject)}catch(c){return}if(messageObject&&"JFE"===messageObject.from&&"SI"===messageObject.to){if(QSI.screenCaptureHandlers||(QSI.screenCaptureHandlers={}),"canScreenCapture"===messageObject.event){var d={event:"canScreenCapture",from:"SI",to:"JFE",canScreenCapture:!0};return void a.source.postMessage(JSON.stringify(d),"*")}switch(QSI.screenCaptureHandlers[messageObject.sessionId]||(QSI.screenCaptureHandlers[messageObject.sessionId]=new QSI.ScreenCaptureHandler(b,a.source,messageObject.sessionId)),messageObject.event){case"startScreenCapture":QSI.screenCaptureHandlers[messageObject.sessionId].captureScreen(messageObject.questionId);break;case"editScreenCapture":QSI.screenCaptureHandlers[messageObject.sessionId].editAnnotations(messageObject.questionId);break;case"removeScreenCapture":QSI.screenCaptureHandlers[messageObject.sessionId].removeScreenCapture(messageObject.questionId);break;case"sessionFinished":QSI.screenCaptureHandlers[messageObject.sessionId].removeAllScreenCaptures();break;default:return}}}}));
(void 0===window.QSI.ScreenCaptureAnnotations||window.QTest)&&(QSI.ScreenCaptureAnnotations=QSI.util.Class({initialize:function(a,b,c){this.annotationsZIndex=QSI.global.currentZIndex++,this.isScreenCaptureSaved=!1,this.createAnnotationsArea(a,b,c)},createAnnotationsArea:function(a,b,c){var d=36,e=8,f=parseInt(window.innerWidth,10),g=parseInt(window.innerHeight,10),h=.95,i=g*(1-.95)/2,j=8,k=g*h-d-e-2*j,l=k/g,m=l*f,n=this.createCanvas(c,m,k),o=this.createActionsBar(a,b,n,d,e),p=this.screenCaptureRectangle.getCanvas();QSI.util.setStyle(p,{position:"absolute",top:j+"px",left:j+"px"});var q="6px",r=QSI.util.build("div",{"data-qsi-sc-class":"qsi_sc_captured_image_area",style:{position:"fixed",top:i+"px",left:f/2-m/2+"px",width:m+"px",zIndex:this.annotationsZIndex,backgroundColor:"white",boxSizing:"content-box",padding:j+"px",borderRadius:q,mozBorderRadius:q,boxShadow:"0px 0px 16px 0px rgba(0,0,0,0.5)"}},[n,p,o]);this.annotationsScreen=QSI.util.build("div",{className:"QSI_ScreenCaptureAnnotations"},[this.createBackDrop(),r]),document.body.appendChild(this.annotationsScreen)},createActionsBar:function(a,b,c,d,e){var f=this.createSaveActions(a,b,c,d),g=this.createAnnotationActions(c,d);return QSI.util.build("div",{"data-qsi-sc-class":"qsi_sc_actions_bar",style:{width:"100%",height:d+"px",marginTop:e+"px"}},[g,f])},createAnnotationActions:function(a,b){this.screenCaptureRectangle=new QSI.ScreenCaptureRectangle(a,5);var c=23,d=QSI.baseURL+"../WRQualtricsShared/Graphics/siteintercept/sc_annotations_sprites.png",e=QSI.util.build("div",{"data-qsi-sc-class":"qsi_sc_highlight_button",title:"Highlight",style:{display:"inline-block",height:c+"px",width:c+"px",cursor:"pointer",background:"url("+d+") 139px 0px"}},[]),f=QSI.util.build("div",{"data-qsi-sc-class":"qsi_sc_blackout_button",title:"Blackout",style:{display:"inline-block",height:c+"px",width:c+"px",cursor:"pointer",marginLeft:"8px",background:"url("+d+") 110px 0px"}},[]),g=parseInt(a.width,10)/2,h=parseInt(a.height,10)/2,i=100,j=50,k=this;QSI.util.observe(e,"click",function(){k.screenCaptureRectangle.addRectangle(g-i/2,h-j/2,i,j,"yellow",.3)}),QSI.util.observe(f,"click",function(){k.screenCaptureRectangle.addRectangle(g-i/2,h-j/2,i,j,"black",1)});var l=(b-c)/2,m=QSI.util.build("div",{"data-qsi-sc-class":"qsi_sc_annotation_actions",style:{"float":"left",boxSizing:"border-box",height:b+"px",padding:l+"px",backgroundColor:"white"}},[e,f]);return m},createSaveActions:function(a,b,c,d){var e=QSI.util.build("div",{"data-qsi-sc-class":"qsi_sc_annotations_cancel_button",style:{display:"inline-block",fontSize:"15px",color:"black",cursor:"pointer",lineHeight:"30px"}},[]),f=this,g=function(){f.cancelButtonCallback(a,b)};QSI.util.observe(e,"click",g),e.innerHTML="Cancel";var h=QSI.util.build("div",{"data-qsi-sc-class":"qsi_sc_annotations_save_button",style:{display:"inline-block",fontSize:"15px",color:"white",backgroundColor:"#14a857",cursor:"pointer",lineHeight:"30px",borderRadius:"4px",padding:"0px 8px 0px 8px",marginLeft:"16px"}},[]),i=function(){f.isScreenCaptureSaved=!0,f.hideAnnotationsArea(),f.screenCaptureRectangle.save(),a.saveScreenCapture(b,f.getAnnotatedImageData(c))};return QSI.util.observe(h,"click",i),h.innerHTML="Save",saveActions=QSI.util.build("div",{"data-qsi-sc-class":"qsi_sc_save_actions",style:{"float":"right",lineHeight:d+"px"}},[e,h]),this.escapeCallBack=function(a){27==a.keyCode&&g()},QSI.util.observe(window,"keydown",this.escapeCallBack),this.returnKeyCallBack=function(a){13==a.keyCode&&i()},QSI.util.observe(window,"keydown",this.returnKeyCallBack),saveActions},getAnnotatedImageData:function(a){var b=QSI.util.build("canvas",{width:a.width,height:a.height},[]);saveContext=b.getContext("2d"),saveContext.drawImage(a,0,0),saveContext.drawImage(this.screenCaptureRectangle.getCleanedCanvas(),0,0);var c=b.toDataURL("image/jpeg");return c},cancelButtonCallback:function(a,b){this.screenCaptureRectangle.cancel(),this.isScreenCaptureSaved?this.hideAnnotationsArea():a.removeScreenCapture(b),a.hideCapturingScreen()},destroyAnnotationsArea:function(){QSI.util.stopObserving(window,"keydown",this.escapeCallBack),QSI.util.stopObserving(window,"keydown",this.returnKeyCallBack),QSI.util.remove(this.annotationsScreen)},hideAnnotationsArea:function(){QSI.util.stopObserving(window,"keydown",this.escapeCallBack),QSI.util.stopObserving(window,"keydown",this.returnKeyCallBack),this.annotationsScreen.style.visibility="hidden"},showAnnotationsArea:function(){QSI.util.observe(window,"keydown",this.escapeCallBack),QSI.util.observe(window,"keydown",this.returnKeyCallBack),this.annotationsScreen.style.visibility="visible"},createCanvas:function(a,b,c){var d="4px",e=QSI.util.build("canvas",{"data-qsi-sc-class":"qsi_sc_capturedimage_canvas",width:b+"px",height:c+"px",style:{boxSizing:"border-box",borderRadius:d,mozBorderRadius:d,boxShadow:"0px 0px 1px 2px rgba(0,0,0,0.1)"}},[]),f=e.getContext("2d"),g=new Image;return g.onload=function(){f.drawImage(g,0,0,b,c)},g.src=a,e},createBackDrop:function(){return QSI.util.build("div",{"data-qsi-sc-class":"qsi_sc_annotations_backdrop",style:{width:"100%",height:"100%",backgroundColor:"black",opacity:"0.5",filter:"alpha(opacity=70)",position:"fixed",top:"0px",left:"0px",zIndex:this.annotationsZIndex-1}},[])}}));
