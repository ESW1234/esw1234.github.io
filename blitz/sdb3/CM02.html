<html>
  <head><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"></head>
  <body>
		<h1>WebMessaging 05 | SDB3 BLITZ</h1>
		<h2>agent5@sdb3.blitz.org</h2>
    </br>

    <h3>Use this link to get JWT - https://portico.sfproxy.controltelemetry.aws-dev2-uswest2.aws.sfdc.cl/api/v1/miaw/getJwtToken?issuer=testIssuer&subject=meu2&jwtExpInSeconds=42300&keyId=5f103f1b-ee38-404c-ac94-83c427764813</h3>

		<!-- Edit page link -->
    </br>
	
	<label for="idToken">Set identity token:</label>
	<input type="text" id="idToken" name="idToken" size="100">
	<button type="button" id="setIdentityToken" onclick="setIdentityToken()"> Confirm </button>
	
	<!-- Clear user session button -->
	<button type="button" id="clearAuthBtn" onclick="clearAuthSession()"> Clear User Session </button>
	
	<script type='text/javascript'>
		document.getElementById('editThisPageLink').href = "https://github.com/ESW1234/esw1234.github.io/edit/master" + window.location.pathname;
		
		function clearAuthSession() {
			console.log("Clearing user session.");
			embeddedservice_bootstrap.userVerificationAPI.clearSession();
		}
		
		function setIdentityToken(token) {
			var token = document.getElementById("idToken").value;
	
			embeddedservice_bootstrap.userVerificationAPI.setIdentityToken({
				"identityTokenType":"JWT",
				// Valid JWT
				"identityToken": token
			});
		}
	
		window.addEventListener("onEmbeddedMessagingReady", () => {
			// Embedded Messaging app ready
			var idpEndpoint = "https://portico.sfproxy.controltelemetry.aws-dev2-uswest2.aws.sfdc.cl/api/v1/miaw/getJwtToken?issuer=testIssuer&subject=meu2&jwtExpInSeconds=42300&keyId=5f103f1b-ee38-404c-ac94-83c427764813";
			console.log("onEmbeddedMessagingReady emitted");
	
			// fetch(idpEndpoint).then(function (response) {
		 //            return response.json();
		 //        }).then(function (data) {
		 //            console.log("Access Token from IDP: " + data.accessToken);
		 //            embeddedservice_bootstrap.userVerificationAPI.setIdentityToken({
		 //                identityTokenType: "JWT",
		 //                identityToken: data.accessToken
		 //            });
		 //        }).catch(function(err) {
		 //            console.error('Something went wrong :', err);
		 //        });
		});
	</script>	
    
    <script type='text/javascript'>
      var initESW = function(gslbBaseURL) {
        // Required if you want labels in a language that’s different from your user’s context.
        embedded_svc.menu.settings.language = 'en'; //For example, enter 'en' or 'en-US'

        embedded_svc.menu.init(
          'https://esw-sdb3-blitz.test1.my.pc-rnd.salesforce.com',
          'https://d.la3-test1-uswest2-core4.pc-aws.salesforceliveagent.com/chat',
          gslbBaseURL,
          '00DSB0000005YCL',
          'CM02'
        );
      };

      if (!window.embedded_svc || !window.embedded_svc.menu) {
        var s = document.createElement('script');
        s.setAttribute('src', 'https://esw-sdb3-blitz.test1.my.pc-rnd.salesforce.com/embeddedservice/menu/fab.min.js');
        s.onload = function() {
          initESW(null);
        };
        document.body.appendChild(s);
      } else {
        // initESW('https://service.force.com');
        initESW('https://esw-sdb3-blitz.test1.my.pc-rnd.salesforce.com');
      }
    </script>
  </body>
</html>
